<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Reservation</title>

    <link rel="icon" th:href="@{/main/img/core-img/favicon.ico}">
    <link rel="stylesheet" th:href="@{/main/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/main/css/classy-nav.css}">
    <link rel="stylesheet" th:href="@{/main/css/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/main/css/animate.css}">
    <link rel="stylesheet" th:href="@{/main/css/magnific-popup.css}">
    <link rel="stylesheet" th:href="@{/main/css/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/main/css/nice-select.css}">
    <link rel="stylesheet" th:href="@{/main/css/travel-icon.css}">
    <link rel="stylesheet" th:href="@{/main/css/style.css}">

    <style>
        .price-calculator {
            border: 2px solid #cb8670;
            background-color: #f8f9fa;
            padding: 20px;
            margin-top: 30px;
            border-radius: 5px;
        }
        .price-calculator h3 {
            color: #cb8670;
            font-weight: bold;
        }
        .price-calculator ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 15px;
        }
        .price-calculator li {
            font-size: 16px;
            color: #363636;
        }
        .total-price {
            font-size: 28px !important;
            color: #363636 !important;
            font-weight: bold;
            margin-top: 10px;
        }
        .contact-form-area label {
            color: #cb8670;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .form-control {
            border: none;
            border-bottom: 2px solid #c9c9c9;
            margin-bottom: 30px;
            font-size: 14px;
            font-style: italic;
            color: #7d7d7d;
            border-radius: 0;
            width: 100%;
            height: 52px;
            padding-left: 0;
        }
        .form-control:focus {
            border-color: #cb8670;
            box-shadow: none;
        }
        /* Fix to ensure date picker text is visible */
        input[type="date"].form-control {
            line-height: 52px;
        }
        select.form-control {
            height: 52px;
        }
        textarea.form-control {
            height: 120px;
        }
    </style>
</head>

<body>

<div class="preloader d-flex align-items-center justify-content-center">
    <div class="cssload-container">
        <div class="cssload-loading"><i></i><i></i><i></i><i></i></div>
    </div>
</div>

<header class="header-area">
    <div class="palatin-main-menu">
        <div class="classy-nav-container breakpoint-off">
            <div class="container">
                <nav class="classy-navbar justify-content-between" id="palatinNav">
                    <a th:href="@{/index}" class="nav-brand"><img th:src="@{/main/img/core-img/logo.png}" alt=""></a>
                    <div class="classy-menu">
                        <div class="classynav">
                            <ul>
                                <li><a th:href="@{/index}">Home</a></li>
                                <li><a th:href="@{/rooms}">Back to Rooms</a></li>
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>
</header>

<section class="contact-form-area section-padding-100">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="section-heading text-center">
                    <div class="line-"></div>
                    <h2>Book Your Reservation</h2>
                </div>
            </div>
        </div>

        <div class="row" th:if="${error}">
            <div class="col-12">
                <div class="alert alert-danger text-center" role="alert">
                    <span th:text="${error}"></span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <form th:action="@{/process-booking}" th:object="${bookingRequest}" method="post" id="reservationForm">

                    <h4 class="mb-30">Guest Information</h4>
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <label>First Name</label>
                            <input type="text" th:field="*{guestFirstName}" class="form-control" placeholder="John" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label>Last Name</label>
                            <input type="text" th:field="*{guestLastName}" class="form-control" placeholder="Doe" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label>Email</label>
                            <input type="email" th:field="*{guestEmail}" class="form-control" placeholder="john.doe@example.com" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label>Phone</label>
                            <input type="tel" th:field="*{guestPhone}" class="form-control" placeholder="Phone Number" required>
                        </div>
                    </div>

                    <h4 class="mt-50 mb-30">Booking Information</h4>
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <label>Check-In Date</label>
                            <input type="date" id="checkInDate" th:field="*{checkInDate}" class="form-control" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label>Check-Out Date</label>
                            <input type="date" id="checkOutDate" th:field="*{checkOutDate}" class="form-control" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label>Number of Guests</label>
                            <input type="number" id="numGuests" th:field="*{numGuests}" class="form-control" value="1" min="1" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label>Room Type</label>
                            <select id="roomType" th:field="*{roomTypeId}" class="form-control" required>
                                <option value="" selected disabled>Choose room type...</option>
                                <option th:each="type : ${roomTypes}"
                                        th:value="${type.roomTypeId}"
                                        th:text="${type.name + ' ($' + type.pricePerNight + ')'}"
                                        th:data-price="${type.pricePerNight}">
                                </option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label>Special Requests/Message</label>
                            <textarea th:field="*{message}" class="form-control" placeholder="Any special requests..."></textarea>
                        </div>
                    </div>

                    <h4 class="mt-50 mb-30">Payment Method</h4>
                    <div class="row">
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" th:field="*{paymentMethod}" id="payCreditCard" value="Credit Card" required>
                                <label class="form-check-label" for="payCreditCard">Credit Card</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" th:field="*{paymentMethod}" id="payPayPal" value="PayPal">
                                <label class="form-check-label" for="payPayPal">PayPal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" th:field="*{paymentMethod}" id="payCash" value="Cash">
                                <label class="form-check-label" for="payCash">Pay Later (Cash at Hotel)</label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="price-calculator">
                                <h3>Price Breakdown</h3>
                                <ul>
                                    <li id="nightCostText">Duration: 0 night(s)</li>
                                    <li id="roomCostText">Room Price: $0.00 / night</li>
                                </ul>
                                <h3 class="total-price">Total: <span id="totalPriceDisplay">$0.00</span></h3>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 text-center mt-50">
                            <button type="submit" class="palatin-btn">Book Now</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</section>

<script th:src="@{/main/js/jquery/jquery-2.2.4.min.js}"></script>
<script th:src="@{/main/js/bootstrap/popper.min.js}"></script>
<script th:src="@{/main/js/bootstrap/bootstrap.min.js}"></script>
<script th:src="@{/main/js/plugins/plugins.js}"></script>
<script th:src="@{/main/js/active.js}"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const checkInEl = document.getElementById('checkInDate');
        const checkOutEl = document.getElementById('checkOutDate');
        const roomTypeEl = document.getElementById('roomType');

        const nightCostTextEl = document.getElementById('nightCostText');
        const roomCostTextEl = document.getElementById('roomCostText');
        const totalPriceEl = document.getElementById('totalPriceDisplay');

        function calculateTotal() {
            let nights = 0;
            if (checkInEl.value && checkOutEl.value) {
                const date1 = new Date(checkInEl.value);
                const date2 = new Date(checkOutEl.value);

                if (date2 > date1) {
                    const diffTime = Math.abs(date2 - date1);
                    nights = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                }
            }

            // Get Price from Data Attribute in Dropdown
            const selectedOption = roomTypeEl.options[roomTypeEl.selectedIndex];
            let pricePerNight = 0;

            if (selectedOption && selectedOption.value !== "") {
                pricePerNight = parseFloat(selectedOption.getAttribute('data-price')) || 0;
            }

            const totalCost = nights * pricePerNight;

            nightCostTextEl.textContent = `Duration: ${nights} night(s)`;
            roomCostTextEl.textContent = `Room Price: $${pricePerNight.toFixed(2)} / night`;
            totalPriceEl.textContent = `$${totalCost.toFixed(2)}`;
        }

        const inputsToWatch = [checkInEl, checkOutEl, roomTypeEl];
        inputsToWatch.forEach(input => {
            input.addEventListener('change', calculateTotal);
        });
    });
</script>
</body>

</html>